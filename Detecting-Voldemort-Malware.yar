/* 
    Enhanced Comprehensive YARA Rule for Detecting Voldemort Malware
	Source : https://github.com/RemusDBD/Detecting-Voldemort-Malware
*/

rule Voldemort_202408_G00
{
   meta:
      description = "Enhanced comprehensive detection of Voldemort malware used in espionage campaigns"
      author = "Remus"
      reference = "https://www.proofpoint.com/us/blog/threat-insight/malware-must-not-be-named-suspected-espionage-campaign-delivers-voldemort"
      date = "2024-09-07"
   strings:
      $a1 = "CiscoSparkLauncher.dll" //dll_hijacking - Known DLL side-loading target
      $a2 = "CiscoCollabHost.exe" // malware_file - Known malware executable
      // Strings related to C2 communication and decryption
      $a3 = "sheets.googleapis.com/v4/spreadsheets" //c2_google_sheet
      $a4 = "g00" // egg_hunting_marker
      $a5 = "/ows/v1/OutlookCloudSettings/settings/global" // c2_uri
      $a6 = "16JvcER-0TVQDimWV56syk91IMCYXOvZbW4GTnb947eE" // google_sheet_id
      $a7 = "ABC_of_Tax.zip" // Decoy files
      $a8 = "La_dichiarazione_precompilata_2024.pdf"
      $b1 = "UUID" // uuid_check
      $b2 = "Voldemort" // voldemort_command
      $c1 = "<viewInfo iconSize=\"32\" stackIconSize=\"0\" displayName=\"Downloads\" autoListFlags=\"0\">" // search_ms_view
      $c2 = "<condition type=\"leafCondition\" property=\"System.FileName\" operator=\"starts with\" propertyType=\"string\" value=\"ABC_of_Tax.zip\" localeName=\"en-US\">" // search_ms_condition
      $c3 = "<include path=\"::{F02C1A0D-BE21-4350-88B0-7367FC96EF3C}\\invasion-prisoners-inns-aging.trycloudflare.com@SSL\\pub\" attributes=\"1887437133\"/>" // search_ms_include
      $d1 = ".lnk" // Detecting Windows shortcut files //malicious_lnk_file  - Additional behavioral and network indicators
      $d2 = ".zip" // Detecting ZIP files used for delivery //malicious_zip_file
      $d3 = "powershell" // Detecting PowerShell usage //power_shell_cmd
      $d4 = "Cobalt Strike" // Known payload marker //cobalt_strike_marker
      $e1 = "GET /api/v1/data" // Detecting specific network requests // network_request  - Advanced indicators
      $e2 = "X1Y2Z3" // Known encrypted payload marker //encrypted_payload
      $e3 = "selfmod" // Detecting self-modifying code //self_modifying_code
      $e4 = "HKEY_CURRENT_USER\\Software\\Voldemort" // suspicious_registry_key
      $e5 = /sheets\.googleapis\.com\/v4\/spreadsheets\/ / //  You can add here for Regular expressions for dynamic detection for dynamic_c2_pattern 
   condition:
      any of ($a*) 
      or
      all of ($b*) and any of ($c*) 
      or
      any of ($d*) and any of ($e*)
}
